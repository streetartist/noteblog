{% extends "admin/base.html" %}

{% block admin_content %}
<div class="admin-settings">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #303133;">系统设置</h2>
        <div>
            <el-button type="primary" @click="saveSettings">
                <i class="el-icon-check"></i> 保存设置
            </el-button>
        </div>
    </div>

    <form method="POST" id="settingsForm">
        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px;">
            <!-- 主要内容区 -->
            <div>
                <!-- 基本设置 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="margin: 0 0 20px 0; color: #303133; font-size: 16px;">基本设置</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">网站标题 <span style="color: #f56c6c;">*</span></label>
                        <el-input name="site_title" value="{{ settings.site_title if settings.site_title else '' }}" placeholder="请输入网站标题" required></el-input>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">网站描述</label>
                        <el-input name="site_description" type="textarea" :rows="3" placeholder="请输入网站描述">{{ settings.site_description if settings.site_description else '' }}</el-input>
                        <div style="font-size: 12px; color: #909399; margin-top: 4px;">用于SEO，建议150字符以内</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">网站关键词</label>
                        <el-input name="site_keywords" placeholder="多个关键词用逗号分隔">{{ settings.site_keywords if settings.site_keywords else '' }}</el-input>
                        <div style="font-size: 12px; color: #909399; margin-top: 4px;">用于SEO，多个关键词用英文逗号分隔</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">网站地址</label>
                        <el-input name="site_url" placeholder="https://example.com">{{ settings.site_url if settings.site_url else '' }}</el-input>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">管理员邮箱</label>
                        <el-input name="admin_email" type="email" placeholder="admin@example.com">{{ settings.admin_email if settings.admin_email else '' }}</el-input>
                    </div>
                </div>

                <!-- 显示设置 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="margin: 0 0 20px 0; color: #303133; font-size: 16px;">显示设置</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">每页文章数</label>
                        <el-input-number name="posts_per_page" :min="5" :max="50" value="{{ settings.posts_per_page if settings.posts_per_page else 10 }}" style="width: 200px;"></el-input-number>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">时区</label>
                        <el-select name="timezone" placeholder="选择时区" style="width: 200px;" value="{{ settings.timezone if settings.timezone else 'Asia/Shanghai' }}">
                            <el-option label="北京时间 (UTC+8)" value="Asia/Shanghai"></el-option>
                            <el-option label="东京时间 (UTC+9)" value="Asia/Tokyo"></el-option>
                            <el-option label="纽约时间 (UTC-5)" value="America/New_York"></el-option>
                            <el-option label="伦敦时间 (UTC+0)" value="Europe/London"></el-option>
                        </el-select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">日期格式</label>
                        <el-select name="date_format" placeholder="选择日期格式" style="width: 200px;" value="{{ settings.date_format if settings.date_format else '%Y-%m-%d' }}">
                            <el-option label="2024-01-01" value="%Y-%m-%d"></el-option>
                            <el-option label="2024/01/01" value="%Y/%m/%d"></el-option>
                            <el-option label="01/01/2024" value="%m/%d/%Y"></el-option>
                            <el-option label="2024年1月1日" value="%Y年%m月%d日"></el-option>
                        </el-select>
                    </div>
                </div>

                <!-- 评论设置 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin: 0 0 20px 0; color: #303133; font-size: 16px;">评论设置</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <el-checkbox name="comment_moderation" {% if settings.comment_moderation == 'true' %}checked{% endif %}>
                            评论需要审核
                        </el-checkbox>
                        <div style="font-size: 12px; color: #909399; margin-top: 4px;">新评论需要管理员审核后才能显示</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <el-checkbox name="comment_registration" {% if settings.comment_registration == 'true' %}checked{% endif %}>
                            仅注册用户可评论
                        </el-checkbox>
                        <div style="font-size: 12px; color: #909399; margin-top: 4px;">只有注册用户才能发表评论</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #606266; font-size: 14px; font-weight: 500;">评论审核关键词</label>
                        <el-input name="comment_blacklist" type="textarea" :rows="3" placeholder="每行一个关键词">{{ settings.comment_blacklist if settings.comment_blacklist else '' }}</el-input>
                        <div style="font-size: 12px; color: #909399; margin-top: 4px;">包含这些关键词的评论将自动标记为垃圾评论</div>
                    </div>
                </div>
            </div>

            <!-- 侧边栏 -->
            <div>
                <!-- 快速操作 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="margin: 0 0 20px 0; color: #303133; font-size: 16px;">快速操作</h3>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <el-button type="primary" native-type="submit" style="width: 100%;">
                            <i class="el-icon-check"></i> 保存设置
                        </el-button>
                        <el-button @click="resetSettings" style="width: 100%;">
                            <i class="el-icon-refresh"></i> 重置设置
                        </el-button>
                        <el-button @click="exportSettings" style="width: 100%;">
                            <i class="el-icon-download"></i> 导出设置
                        </el-button>
                        <el-button @click="importSettings" style="width: 100%;">
                            <i class="el-icon-upload2"></i> 导入设置
                        </el-button>
                    </div>
                </div>

                <!-- 系统信息 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin: 0 0 20px 0; color: #303133; font-size: 16px;">系统信息</h3>
                    
                    <div style="font-size: 12px; color: #909399; line-height: 1.6;">
                        <div style="margin-bottom: 8px;">
                            <strong>Noteblog版本：</strong>1.0.0
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>Python版本：</strong>3.8+
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>Flask版本：</strong>2.0+
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>数据库：</strong>MySQL
                        </div>
                        <div>
                            <strong>最后更新：</strong>{{ settings.updated_at if settings.updated_at else '刚刚' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
const { createApp } = Vue;
const app = createApp({
    methods: {
        saveSettings() {
            // 提交表单
            document.getElementById('settingsForm').submit();
        },
        resetSettings() {
            this.$confirm('确定要重置所有设置吗？此操作不可恢复。', '确认重置', {
                confirmButtonText: '确定重置',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.$message.info('重置设置功能开发中...');
            }).catch(() => {
                this.$message.info('已取消重置');
            });
        },
        exportSettings() {
            this.$message.info('导出设置功能开发中...');
        },
        importSettings() {
            this.$message.info('导入设置功能开发中...');
        }
    }
});

// 注册Element Plus
app.use(ElementPlus);
app.mount('.admin-settings');
</script>
{% endblock %}

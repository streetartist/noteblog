{% extends "base.html" %}

{% block title %}忘记密码 - {{ site_title or 'Noteblog' }}{% endblock %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>忘记密码</h2>
                <p>请输入您的邮箱地址，我们将向您发送密码重置链接</p>
            </div>
            
            <form method="POST" class="auth-form" @submit.prevent="handleForgotPasswordSubmit">
                <!-- Flash messages will be handled by the theme manager -->
                
                <div class="form-group">
                    <el-form-item label="邮箱地址" required :error="errors.email">
                        <el-input
                            v-model="forgotPasswordForm.email"
                            type="email"
                            placeholder="请输入您的邮箱地址"
                            clearable
                            required>
                        </el-input>
                    </el-form-item>
                </div>
                
                <div class="security-notice">
                    <el-alert
                        title="安全提示"
                        type="info"
                        :closable="false"
                        show-icon>
                        <template #default>
                            <ul>
                                <li>密码重置链接将在24小时后失效</li>
                                <li>请确保您能够访问该邮箱</li>
                                <li>如果没有收到邮件，请检查垃圾邮件文件夹</li>
                            </ul>
                        </template>
                    </el-alert>
                </div>
                
                <div class="form-actions">
                    <el-button @click="goBack">返回登录</el-button>
                    <el-button type="primary" @click="handleForgotPasswordSubmit" :loading="isSubmitting">
                        发送重置链接
                    </el-button>
                </div>
            </form>
            
            <div class="auth-footer">
                <p>
                    想起密码了？
                    <a href="{{ url_for('main.login') }}" class="auth-link">返回登录</a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.auth-page {
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
}

.auth-container {
    width: 100%;
    max-width: 420px;
}

.auth-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    padding: 40px;
}

.auth-header {
    text-align: center;
    margin-bottom: 30px;
}

.auth-header h2 {
    color: #303133;
    margin-bottom: 10px;
    font-size: 24px;
}

.auth-header p {
    color: #909399;
    margin: 0;
    font-size: 14px;
    line-height: 1.5;
}

.auth-form {
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.security-notice {
    margin-bottom: 25px;
}

.security-notice ul {
    margin: 8px 0 0 0;
    padding-left: 20px;
}

.security-notice li {
    margin-bottom: 5px;
    font-size: 13px;
    color: #606266;
}

.form-actions {
    margin-top: 25px;
    display: flex;
    gap: 15px;
    justify-content: space-between;
}

.auth-footer {
    text-align: center;
    border-top: 1px solid #ebeef5;
    padding-top: 20px;
    margin-top: 20px;
}

.auth-footer p {
    margin: 0;
    color: #909399;
    font-size: 14px;
}

.auth-link {
    color: var(--primary-color, #409EFF);
    text-decoration: none;
}

.auth-link:hover {
    text-decoration: underline;
}

/* 响应式设计 */
@media (max-width: 480px) {
    .auth-card {
        padding: 20px;
    }
    
    .auth-header h2 {
        font-size: 20px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .el-button {
        width: 100%;
    }
}
</style>

<script>
// 忘记密码页面专用的Vue应用
document.addEventListener('DOMContentLoaded', function() {
    // 如果全局Vue应用已存在，扩展它
    if (window._noteblog_app) {
        const app = window._noteblog_app;
        
        // 添加忘记密码页面特定的数据和方法
        app.config.globalProperties.forgotPasswordForm = {
            email: ''
        };
        
        app.config.globalProperties.errors = {
            email: ''
        };
        
        app.config.globalProperties.isSubmitting = false;
        
        app.config.globalProperties.goBack = function() {
            window.location.href = '/auth/login';
        };
        
        app.config.globalProperties.handleForgotPasswordSubmit = function() {
            const ElMessage = ElementPlus.ElMessage || ElementPlus;
            
            // 清除之前的错误
            this.errors.email = '';
            
            // 验证表单
            if (!this.forgotPasswordForm.email.trim()) {
                this.errors.email = '请输入邮箱地址';
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(this.forgotPasswordForm.email)) {
                this.errors.email = '请输入有效的邮箱地址';
                return;
            }
            
            // 设置提交状态
            this.isSubmitting = true;
            
            // 创建表单数据并提交
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/auth/forgot-password';
            
            const emailInput = document.createElement('input');
            emailInput.type = 'hidden';
            emailInput.name = 'email';
            emailInput.value = this.forgotPasswordForm.email;
            form.appendChild(emailInput);
            
            document.body.appendChild(form);
            form.submit();
        };
    }
});
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ site_title or 'Noteblog' }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ site_description or '' }}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{{ site_keywords or '' }}{% endblock %}">
    
    <!-- Favicon -->
    {% if get_theme_config().site_favicon %}
    <link rel="icon" href="{{ get_theme_config().site_favicon }}">
    {% endif %}
    
    <!-- CSS -->
    <link rel="stylesheet" href="/themes/aurora/static/css/aurora.css">
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- ä¸»é¢˜è‰²å˜é‡ -->
    <style>
        :root {
            --primary-color: {{ get_theme_config().primary_color or '#667eea' }};
            --secondary-color: {{ get_theme_config().secondary_color or '#764ba2' }};
            --accent-color: {{ get_theme_config().accent_color or '#f093fb' }};
        }
    </style>
    
    {% block head %}{% endblock %}
    
    <!-- æ’ä»¶èµ„æºé’©å­ï¼šå¤´éƒ¨CSS -->
    {% if plugin_hooks and plugin_hooks.head_assets %}
        {% for asset_content in plugin_hooks.head_assets %}
            {{ asset_content|safe }}
        {% endfor %}
    {% endif %}
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨ -->
        <header class="site-header">
            <div class="container">
                <div class="header-content">
                    <div class="site-branding">
                        {% if get_theme_config().site_logo %}
                        <img src="{{ get_theme_config().site_logo }}" alt="{{ site_title }}" class="site-logo">
                        {% endif %}
                        <div>
                            <h1 class="site-title">
                                <a href="/">{{ site_title or 'Noteblog' }}</a>
                            </h1>
                            {% if site_description %}
                            <p class="site-description">{{ site_description }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <nav class="main-navigation">
                        <div class="aurora-nav">
                            <a href="/" class="aurora-nav-item {% if request.path == '/' %}active{% endif %}">
                                <span>é¦–é¡µ</span>
                            </a>
                            <a href="/archives" class="aurora-nav-item {% if request.path == '/archives' %}active{% endif %}">
                                <span>å½’æ¡£</span>
                            </a>
                            <a href="/categories" class="aurora-nav-item {% if request.path == '/categories' %}active{% endif %}">
                                <span>åˆ†ç±»</span>
                            </a>
                            <a href="/tags" class="aurora-nav-item {% if request.path == '/tags' %}active{% endif %}">
                                <span>æ ‡ç­¾</span>
                            </a>
                            <a href="/search" class="aurora-nav-item {% if request.path == '/search' %}active{% endif %}">
                                <span>æœç´¢</span>
                            </a>
                        </div>
                    </nav>
                    
                    <div class="user-menu">
                        <button class="mobile-nav-toggle" title="èœå•">â˜°</button>
                        {% if get_theme_config().enable_dark_mode != false %}
                        <button class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
                        {% endif %}
                        
                        {% if current_user.is_authenticated %}
                        <div class="user-dropdown">
                            <div class="user-avatar">
                                {{ (current_user.display_name or current_user.username)[:1].upper() }}
                            </div>
                            <div class="user-menu-dropdown">
                                <a href="/auth/profile">ä¸ªäººèµ„æ–™</a>
                                <a href="/?modal=edit_profile" data-modal-trigger="edit_profile">ç¼–è¾‘èµ„æ–™</a>
                                {% if current_user.is_admin %}
                                <a href="/admin">ç®¡ç†åå°</a>
                                {% endif %}
                                <a href="/auth/logout">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                        {% else %}
                        <a href="/?modal=login" class="aurora-nav-item" data-modal-trigger="login">ç™»å½•</a>
                        <a href="/?modal=register" class="aurora-nav-item" data-modal-trigger="register">æ³¨å†Œ</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="site-main">
            <div class="container">
                <div class="content-wrapper {% if get_theme_config().show_sidebar == false or _admin_page %}no-sidebar{% endif %}">
                    <!-- ä¸»å†…å®¹åŒº -->
                    <div class="main-content">
                        {% block content %}{% endblock %}
                    </div>
                    
                    <!-- ä¾§è¾¹æ  -->
                    {% if get_theme_config().show_sidebar != false and not _admin_page %}
                    <aside class="sidebar">
                        {% block sidebar %}
                        <!-- æœ€æ–°æ–‡ç«  -->
                        <div class="widget">
                            <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
                            <ul class="widget-list">
                                {% for post in (recent_posts|default([]))[:5] %}
                                <li>
                                    <a href="/post/{{ post.slug }}">{{ post.title }}</a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        
                        <!-- åˆ†ç±» -->
                        <div class="widget">
                            <h3 class="widget-title">åˆ†ç±»</h3>
                            <ul class="widget-list">
                                {% for category in (categories|default([])) %}
                                <li>
                                    <a href="/category/{{ category.slug }}">{{ category.name }} ({{ category.post_count or 0 }})</a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        
                        <!-- æ ‡ç­¾ -->
                        <div class="widget">
                            <h3 class="widget-title">æ ‡ç­¾</h3>
                            <div class="tag-cloud">
                                {% for tag in (tags|default([])) %}
                                <a href="/tag/{{ tag.slug }}" class="tag-cloud-item">{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- æ’ä»¶é’©å­ï¼šä¾§è¾¹æ åº•éƒ¨ -->
                        {% if plugin_hooks and plugin_hooks.sidebar_bottom %}
                            {% for hook_content in plugin_hooks.sidebar_bottom %}
                                {{ hook_content|safe }}
                            {% endfor %}
                        {% endif %}
                        {% endblock %}
                    </aside>
                    {% endif %}
                </div>
            </div>
        </main>

        <!-- é¡µè„š -->
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <p>{{ get_theme_config().footer_text or 'Â© 2025 Noteblog. Crafted with Aurora Theme.' }}</p>
                    <p>
                        Powered by <a href="https://github.com/streetartist/noteblog">Noteblog</a> | 
                        Theme Aurora
                    </p>
                </div>
            </div>
        </footer>

        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <div class="back-to-top">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 15l-6-6-6 6"/>
            </svg>
        </div>
        
        <!-- æœç´¢æ¨¡æ€æ¡† -->
        <div class="search-modal" aria-hidden="true" role="dialog" aria-modal="true">
            <div class="search-modal-content" role="document">
                <div class="search-modal-header">
                    <h3>æœç´¢æ–‡ç« </h3>
                    <button class="search-close" type="button" aria-label="å…³é—­æœç´¢">&times;</button>
                </div>
                <form class="search-form" action="/search" method="GET">
                    <input type="text" name="q" class="search-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢..." autocomplete="off">
                    <button type="submit">æœç´¢</button>
                </form>
            </div>
        </div>

        {% if not current_user.is_authenticated %}
        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div class="auth-modal" data-modal="login" aria-hidden="true" role="dialog" aria-modal="true">
            <div class="auth-modal-content" role="document">
                <div class="auth-modal-header">
                    <h3>ç™»å½•</h3>
                    <button class="modal-close" type="button" data-modal-close aria-label="å…³é—­ç™»å½•å¼¹çª—">&times;</button>
                </div>
                <form class="modal-form" action="{{ url_for('auth.login') }}" method="POST">
                    <div class="form-field">
                        <label for="login-username">ç”¨æˆ·åæˆ–é‚®ç®±</label>
                        <input type="text" id="login-username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±" required autocomplete="username">
                    </div>
                    <div class="form-field">
                        <label for="login-password">å¯†ç </label>
                        <input type="password" id="login-password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required autocomplete="current-password">
                    </div>
                    <label class="form-checkbox-inline">
                        <input type="checkbox" name="remember_me" value="on">
                        <span>è®°ä½æˆ‘</span>
                    </label>
                    <button type="submit" class="modal-submit">ç™»å½•</button>
                </form>
                <div class="modal-footer-links">
                    <button type="button" class="modal-link" data-modal-switch="forgot_password">å¿˜è®°å¯†ç ï¼Ÿ</button>
                    <button type="button" class="modal-link" data-modal-switch="register">è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿæ³¨å†Œ</button>
                </div>
            </div>
        </div>

        <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
        <div class="auth-modal" data-modal="register" aria-hidden="true" role="dialog" aria-modal="true">
            <div class="auth-modal-content" role="document">
                <div class="auth-modal-header">
                    <h3>æ³¨å†Œ</h3>
                    <button class="modal-close" type="button" data-modal-close aria-label="å…³é—­æ³¨å†Œå¼¹çª—">&times;</button>
                </div>
                <form class="modal-form" action="{{ url_for('auth.register') }}" method="POST">
                    <div class="form-field">
                        <label for="register-username">ç”¨æˆ·å</label>
                        <input type="text" id="register-username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-field">
                        <label for="register-email">é‚®ç®±</label>
                        <input type="email" id="register-email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±" required autocomplete="email">
                    </div>
                    <div class="form-field">
                        <label for="register-display">æ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="register-display" name="display_name" placeholder="ç”¨äºå±•ç¤ºçš„æ˜µç§°">
                    </div>
                    <div class="form-field">
                        <label for="register-password">å¯†ç </label>
                        <input type="password" id="register-password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " minlength="6" required autocomplete="new-password">
                    </div>
                    <div class="form-field">
                        <label for="register-confirm">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="register-confirm" name="confirm_password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " minlength="6" required autocomplete="new-password">
                    </div>
                    <button type="submit" class="modal-submit">æ³¨å†Œ</button>
                </form>
                <div class="modal-footer-links">
                    <button type="button" class="modal-link" data-modal-switch="login">å·²æœ‰è´¦æˆ·ï¼Ÿç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- å¿˜è®°å¯†ç æ¨¡æ€æ¡† -->
        <div class="auth-modal" data-modal="forgot_password" aria-hidden="true" role="dialog" aria-modal="true">
            <div class="auth-modal-content" role="document">
                <div class="auth-modal-header">
                    <h3>æ‰¾å›å¯†ç </h3>
                    <button class="modal-close" type="button" data-modal-close aria-label="å…³é—­æ‰¾å›å¯†ç å¼¹çª—">&times;</button>
                </div>
                <form class="modal-form" action="{{ url_for('auth.forgot_password') }}" method="POST">
                    <div class="form-field">
                        <label for="forgot-email">é‚®ç®±åœ°å€</label>
                        <input type="email" id="forgot-email" name="email" placeholder="è¯·è¾“å…¥æ³¨å†Œé‚®ç®±" required autocomplete="email">
                    </div>
                    <p class="modal-helper-text">æˆ‘ä»¬ä¼šå‘è¯¥é‚®ç®±å‘é€å¯†ç é‡ç½®é“¾æ¥ï¼Œè¯·ç¡®ä¿å¯ä»¥æ­£å¸¸æ¥æ”¶é‚®ä»¶ã€‚</p>
                    <button type="submit" class="modal-submit">å‘é€é‡ç½®é“¾æ¥</button>
                </form>
                <div class="modal-footer-links">
                    <button type="button" class="modal-link" data-modal-switch="login">è¿”å›ç™»å½•</button>
                    <button type="button" class="modal-link" data-modal-switch="register">éœ€è¦æ–°è´¦æˆ·ï¼Ÿç«‹å³æ³¨å†Œ</button>
                </div>
            </div>
        </div>
        {% endif %}

        {% if current_user.is_authenticated %}
        <!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†ï¼ˆç™»å½•åå¯ç”¨ï¼‰ -->
        <div class="auth-modal" data-modal="edit_profile" aria-hidden="true" role="dialog" aria-modal="true">
            <div class="auth-modal-content" role="document">
                <div class="auth-modal-header">
                    <h3>ç¼–è¾‘èµ„æ–™</h3>
                    <button class="modal-close" type="button" data-modal-close aria-label="å…³é—­ç¼–è¾‘èµ„æ–™å¼¹çª—">&times;</button>
                </div>
                <form class="modal-form" action="{{ url_for('auth.edit_profile') }}" method="POST" enctype="multipart/form-data">
                    <div class="form-field">
                        <label for="edit-display">æ˜¾ç¤ºåç§°</label>
                        <input type="text" id="edit-display" name="display_name" value="{{ current_user.display_name or current_user.username }}" placeholder="ç”¨äºå±•ç¤ºçš„æ˜µç§°">
                    </div>
                    <div class="form-field">
                        <label for="edit-email">é‚®ç®±</label>
                        <input type="email" id="edit-email" name="email" value="{{ current_user.email or '' }}" placeholder="è¯·è¾“å…¥é‚®ç®±" required autocomplete="email">
                    </div>
                    <div class="form-field">
                        <label for="edit-website">ä¸ªäººç½‘ç«™ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="url" id="edit-website" name="website" value="{{ current_user.website or '' }}" placeholder="https://example.com">
                    </div>
                    <div class="form-field">
                        <label for="edit-location">æ‰€åœ¨åŸå¸‚ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="edit-location" name="location" value="{{ current_user.location or '' }}" placeholder="ä¾‹å¦‚ï¼šä¸Šæµ·">
                    </div>
                    <div class="form-field">
                        <label for="edit-bio">ä¸ªäººç®€ä»‹ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="edit-bio" name="bio" rows="3" placeholder="ä¸€å¥è¯ä»‹ç»è‡ªå·±">{{ current_user.bio or '' }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="edit-avatar">å¤´åƒï¼ˆå¯é€‰ï¼‰</label>
                        <input type="file" id="edit-avatar" name="avatar" accept="image/png,image/jpeg,image/gif,image/webp">
                    </div>
                    <button type="submit" class="modal-submit">ä¿å­˜ä¿®æ”¹</button>
                </form>
                <div class="modal-footer-links">
                    <a href="{{ url_for('auth.change_password') }}" class="modal-link">ä¿®æ”¹å¯†ç </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- JavaScript -->
    <script src="/themes/aurora/static/js/aurora.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script>
    (function() {
        const renderOptions = {
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\[', right: '\\]', display: true },
                { left: '\\(', right: '\\)', display: false }
            ],
            throwOnError: false
        };

        function renderAuroraMath(root) {
            if (typeof katex === 'undefined' || typeof renderMathInElement === 'undefined') {
                return;
            }
            const target = root || document.body;
            if (target) {
                renderMathInElement(target, renderOptions);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderAuroraMath();
        });

        window.addEventListener('aurora:content-updated', function(event) {
            const root = event && event.detail && event.detail.root;
            renderAuroraMath(root || document.body);
        });

        window.auroraRenderMath = renderAuroraMath;
    })();
    </script>
    
    {% block scripts %}{% endblock %}
    
    <!-- æ’ä»¶èµ„æºé’©å­ï¼šJavaScript -->
    {% if plugin_hooks and plugin_hooks.scripts_assets %}
        {% for asset_content in plugin_hooks.scripts_assets %}
            {{ asset_content|safe }}
        {% endfor %}
    {% endif %}
    
    <!-- ç»Ÿè®¡ä»£ç  -->
    {% if get_theme_config().analytics_code %}
    {{ get_theme_config().analytics_code|safe }}
    {% endif %}
</body>
</html>
